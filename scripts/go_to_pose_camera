#!/usr/bin/env python3

import rclpy
import gymnasium as gym
from stable_baselines3 import PPO
from stable_baselines3.common.env_util import make_vec_env
from rosgym.register_env import register_depth_nav_env


def main(args=None):
    rclpy.init(args=args)

    register_depth_nav_env()

    # Create the environment
    env = make_vec_env("DepthNavEnv-v0", n_envs=1)

    # Create the agent
    model = PPO("CnnPolicy", env, verbose=1, policy_kwargs={"normalize_images": False})

    print("Training start")

    # Train the model
    model.learn(total_timesteps=100000, progress_bar=True)

    # Save the model
    model.save("depth_nav_model")

    # Close the environment
    env.close()

    rclpy.shutdown()

if __name__ == "__main__":
    main()

